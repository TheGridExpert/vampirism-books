<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="vampire-theme" content="light">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-con" href="icon.ico">
  <link rel="canonical" href="https://thegridexpert.github.io/vampirism-books">
  <title>Vampirism Mod Lore Books</title>
  <meta name="description" content="Contains an up-to-date collection of vampire books (lore entries) from Vampirism mod for Minecraft. Available in English, Russian, and Ukrainian.">
  <style>
    :root {
      /* Light theme */
      --bg: #fdf6ff;
      --text: #4b2e83;
      --text-light: #6a519e;
      --border: #d9c2e5;
      --accent: #9d7cb2;
      --panel-bg: #f8f0ff;
      --switch-bg: #e0d0f0;
    }
    /* Dark theme */
    [data-theme="dark"] {
      /* Dark theme */
      --bg: #0f0b15;
      --text: #d6c2f0;
      --text-light: #b088e0;
      --border: #4a3a6b;
      --accent: #7a5ca8;
      --panel-bg: #1a1525;
      --switch-bg: #3a2f55;
    }
    * {
      box-sizing: border-box;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      max-width: 850px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 12px;
    }
    .theme-toggle {
      background: var(--switch-bg);
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      color: var(--text);
      cursor: pointer;
      font-weight: 600;
    }
    #language-selector {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #language-selector label {
      font-weight: bold;
      color: var(--text-light);
    }
    #language-selector select {
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--panel-bg);
      color: var(--text);
      font-size: 15px;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
      color: var(--text);
    }
    .book-container {
      margin-bottom: 24px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--panel-bg);
      overflow: hidden;
    }
    .book-title {
      padding: 14px 18px;
      font-size: 1.25em;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--panel-bg);
    }
    .book-title::after {
      content: "‚ñº";
      font-size: 0.8em;
      color: var(--text-light);
      transition: transform 0.25s;
      transform: translateY(30px);
    }
    .book-title.collapsed::after {
      transform: translateY(30px) rotate(180deg);
    }
    .book-author {
      font-size: 0.9em;
      color: var(--text-light);
      margin-top: -15px;
      padding: 0 18px 8px;
    }
    .book-content {
      padding: 0 18px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }
    .book-content.expanded {
      padding: 18px;
      max-height: none;
    }
    .book-content > .no-translation {
      font-style: italic;
      color: var(--text-light);
      margin: 8px 0;
    }
    .page {
      white-space: pre-wrap;
      margin-bottom: 16px;
      line-height: 1.6;
    }
    .page:last-child {
      margin-bottom: 0;
    }
    .page span {
      white-space: pre-wrap;
    }
    .page-divider {
      height: 1px;
      background-color: var(--border);
      margin: 16px 0;
      border: none;
    }
    .credit {
      font-style: italic;
      color: var(--text-light);
      margin-top: 10px;
      border-top: 1px dashed var(--border);
      padding-top: 8px;
    }
    .loading,
    .error {
      text-align: center;
      padding: 16px;
      color: var(--text-light);
    }
    .error {
      color: #ff6b6b;
    }
  </style>
</head>
<body>
  <h1 id="page-title">Vampirism Lore Books</h1>
  <div class="controls">
    <div id="language-selector">
      <label id="lang-label" for="lang-select">Language:</label>
      <select id="lang-select">
        <option value="en_us">English</option>
        <option value="ru_ru">–†—É—Å—Å–∫–∏–π</option>
        <option value="uk_ua">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
      </select>
    </div>
    <button class="theme-toggle" id="theme-toggle">üåô Dark Mode</button>
  </div>
  <div id="books-container">
    <div class="loading">Loading books‚Ä¶</div>
  </div>
  <div style="display:none;">
    <h2>List of available Vampirism Lore Books</h2>
    <ul>
      <li>Ashes of Past Dawns</li>
      <li>Case File #144</li>
      <li>Case Study I</li>
      <li>Insights to the History: The Century of Evolution</li>
      <li>Dear Martha</li>
      <li>Hunter's Diary</li>
      <li>Blood Infusion Breakthrough</li>
      <li>Journal of a Mad Man</li>
      <li>A Maid's Diary</li>
      <li>My Mother</li>
      <li>My Prince</li>
      <li>Nocturnal</li>
      <li>Observation on Vampires</li>
      <li>Pyromaniac's Diary</li>
      <li>Royal Rivalry</li>
      <li>Sinister Intentions</li>
      <li>A Valorous Tale</li>
      <li>WANTED</li>
    </ul>
  </div>

  <script>
    const UI_TEXT = {
      en_us: {
        title: "Vampirism Lore Books",
        langLabel: "Language:",
        noTranslation: (langName) => `No translation available. Showing English.`,
        darkMode: "‚òæ Dark Mode",
        lightMode: "‚òÄ Light Mode",
        byAuthor: "by: "
      },
      ru_ru: {
        title: "–ö–Ω–∏–≥–∏ –ª–æ—Ä–∞ –í–∞–º–ø–∏—Ä–∏–∑–º–∞",
        langLabel: "–Ø–∑—ã–∫:",
        noTranslation: (langName) => `–ü–µ—Ä–µ–≤–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º.`,
        darkMode: "‚òæ –¢—ë–º–Ω—ã–π —Ä–µ–∂–∏–º",
        lightMode: "‚òÄ –°–≤–µ—Ç–ª—ã–π —Ä–µ–∂–∏–º",
        byAuthor: "–ê–≤—Ç–æ—Ä: "
      },
      uk_ua: {
        title: "–ö–Ω–∏–≥–∏ –ª–æ—Ä—É –í–∞–º–ø—ñ—Ä—ñ–∑–º–∞",
        langLabel: "–ú–æ–≤–∞:",
        noTranslation: (langName) => `–ü–µ—Ä–µ–∫–ª–∞–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ü–æ–∫–∞–∑–∞–Ω–æ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é.`,
        darkMode: "‚òæ –¢–µ–º–Ω–∏–π —Ä–µ–∂–∏–º",
        lightMode: "‚òÄ –°–≤—ñ—Ç–ª–∏–π —Ä–µ–∂–∏–º",
        byAuthor: "–≤—ñ–¥: "
      }
    };
    const LANG_NAMES = {
      en_us: "English",
      ru_ru: "–†—É—Å—Å–∫–∏–π",
      uk_ua: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞"
    };

    function normalizeNewlines(text) {
      if (typeof text !== 'string') return text;
      let result = text.trim();
      result = result.replace(/\n{4,}/g, '\n\n\n');
      return result;
    }

    function parseMinecraftText(raw) {
      if (!raw || !raw.includes('¬ß')) {
        return document.createTextNode(raw || '');
      }
      const container = document.createDocumentFragment();
      let currentStyle = {};
      let buffer = '';
      let i = 0;
      const flush = () => {
        if (buffer) {
          const span = document.createElement('span');
          span.textContent = buffer;
          if (currentStyle.bold) span.style.fontWeight = 'bold';
          if (currentStyle.italic) span.style.fontStyle = 'italic';
          let deco = '';
          if (currentStyle.underline) deco += ' underline';
          if (currentStyle.strikethrough) deco += ' line-through';
          if (deco) span.style.textDecoration = deco.trim();
          container.appendChild(span);
          buffer = '';
        }
      };
      while (i < raw.length) {
        if (raw[i] === '¬ß' && i + 1 < raw.length) {
          flush();
          const code = raw[i + 1];
          i += 2;
          if (code === 'r') {
            currentStyle = {};
          } else if (code === 'l') {
            currentStyle.bold = true;
          } else if (code === 'o') {
            currentStyle.italic = true;
          } else if (code === 'n') {
            currentStyle.underline = true;
          } else if (code === 'm') {
            currentStyle.strikethrough = true;
          }
        } else {
          buffer += raw[i];
          i++;
        }
      }
      flush();
      return container;
    }

    // The book list is hardcoded to avoid github request overload
    const KNOWN_BOOK_IDS = [
      "ashes_of_past_dawns",
      "case_file_144",
      "case_study_one",
      "century_of_evolution",
      "dear_martha",
      "hunters_diary",
      "infusion_breakthrough",
      "mad_mans_journal",
      "maids_diary",
      "my_mother",
      "my_prince",
      "nocturnal",
      "observation_on_vampires",
      "pyromaniacs_diary",
      "royal_rivalry",
      "sinister_intentions",
      "valorous_tale",
      "wanted"
    ];

    const RAW_BASE = 'https://raw.githubusercontent.com/TeamLapen/Vampirism/dev/projects/vampirism/src/main/resources/assets/vampirism';
    const AUTHOR_BASE = 'https://raw.githubusercontent.com/TeamLapen/Vampirism/dev/projects/vampirism/src/generated/resources/data/vampirism/vampirism/vampire_book';
    let allBooksData = {};
    let langTitles = {};
    let bookAuthors = {};

    const themeToggle = document.getElementById('theme-toggle');
    let currentTheme = localStorage.getItem('vampire-theme') === 'dark' ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', currentTheme);
    themeToggle.textContent = currentTheme === 'dark' ? UI_TEXT.en_us.lightMode : UI_TEXT.en_us.darkMode;

    themeToggle.addEventListener('click', () => {
      currentTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', currentTheme);
      const lang = document.getElementById('lang-select').value;
      updateUIText(lang);
      localStorage.setItem('vampire-theme', currentTheme);
    });

    async function loadLanguageFiles() {
      const langCodes = ['en_us', 'ru_ru', 'uk_ua'];
      for (const lang of langCodes) {
        try {
          const url = `${RAW_BASE}/lang/${lang}.json`;
          const response = await fetch(url);
          if (response.ok) {
            langTitles[lang] = await response.json();
          }
        } catch (e) {
          console.warn(`Failed to load ${lang} language file`);
        }
      }
    }

    async function loadBookAuthors() {
      for (const bookId of KNOWN_BOOK_IDS) {
        try {
          const url = `${AUTHOR_BASE}/${bookId}.json`;
          const response = await fetch(url);
          if (!response.ok) continue;
          const data = await response.json();
          const author = data.author;

          if (typeof author === 'string') {
            bookAuthors[bookId] = { type: 'literal', value: author };
          } else if (author && typeof author === 'object' && author.translate) {
            bookAuthors[bookId] = { type: 'translate', value: author.translate };
          }
        } catch (e) {
          // Skip if the author file is missing or invalid
        }
      }
    }

    function getAuthorName(bookId, lang) {
      const authorInfo = bookAuthors[bookId];

      function resolveKey(key) {
        if (langTitles[lang]?.[key]) return langTitles[lang][key];
        if (langTitles.en_us?.[key]) return langTitles.en_us[key];
        return 'unknown';
      }

      if (!authorInfo) {
        return resolveKey('vampire_book.vampirism.unknown.author');
      }

      if (authorInfo.type === 'literal') {
        return authorInfo.value;
      }

      if (authorInfo.type === 'translate') {
        return resolveKey(authorInfo.value);
      }

      return resolveKey('vampire_book.vampirism.unknown.author');
    }

    async function loadBooks() {
      const container = document.getElementById('books-container');
      container.innerHTML = '';

      for (const bookId of KNOWN_BOOK_IDS) {
        allBooksData[bookId] = {};
        const langCodes = ['en_us', 'ru_ru', 'uk_ua'];
        for (const lang of langCodes) {
          try {
            const url = `${RAW_BASE}/vampire_books/${bookId}/${lang}.json`;
            const response = await fetch(url);
            if (!response.ok) continue;
            let rawData = await response.json();

            const data = { ...rawData };
            if (Array.isArray(data.contents)) {
              data.contents = data.contents.map(page => normalizeNewlines(page));
            }
            if (typeof data.credit === 'string') {
              data.credit = normalizeNewlines(data.credit);
            }

            allBooksData[bookId][lang] = data;
          } catch (e) {}
        }
      }

      renderBooks();
    }

    function getBookTitle(bookId, lang) {
      const key = `vampire_book.vampirism.${bookId}`;
      if (langTitles[lang]?.[key]) return langTitles[lang][key];
      if (langTitles.en_us?.[key]) return langTitles.en_us[key];
      return bookId.replace(/_/g, ' ');
    }

    function updateUIText(lang) {
      const ui = UI_TEXT[lang] || UI_TEXT.en_us;
      document.getElementById('page-title').textContent = ui.title;
      document.getElementById('lang-label').textContent = ui.langLabel;
      themeToggle.textContent = currentTheme === 'dark' ? ui.lightMode : ui.darkMode;
    }

    function renderBooks() {
      const container = document.getElementById('books-container');
      container.innerHTML = '';

      const bookIds = KNOWN_BOOK_IDS;
      bookIds.forEach(id => {
        const div = document.createElement('div');
        div.className = 'book-container';
        div.dataset.bookId = id;

        const titleContainer = document.createElement('div');
        titleContainer.style.padding = '14px 18px';
        titleContainer.style.cursor = 'pointer';
        titleContainer.style.borderBottom = '1px solid var(--border)';

        const titleDiv = document.createElement('div');
        titleDiv.className = 'book-title';
        titleDiv.style.display = 'flex';
        titleDiv.style.justifyContent = 'space-between';
        titleDiv.style.alignItems = 'center';
        titleDiv.style.fontWeight = '600';
        titleDiv.style.fontSize = '1.25em';
        titleDiv.style.marginBottom = '4px';
        titleDiv.textContent = getBookTitle(id, 'en_us');

        const authorDiv = document.createElement('div');
        authorDiv.className = 'book-author';
        const authorName = getAuthorName(id, 'en_us');
        const ui = UI_TEXT.en_us;
        authorDiv.textContent = authorName ? ui.byAuthor + authorName : '';

        titleContainer.appendChild(titleDiv);
        titleContainer.appendChild(authorDiv);

        titleContainer.addEventListener('click', () => {
          titleDiv.classList.toggle('collapsed');
          contentDiv.classList.toggle('expanded');
        });

        const contentDiv = document.createElement('div');
        contentDiv.className = 'book-content';

        div.appendChild(titleContainer);
        div.appendChild(contentDiv);
        container.appendChild(div);
      });

      updateBookContents();
    }

    function updateBookContents() {
      const lang = document.getElementById('lang-select').value;
      updateUIText(lang);

      document.querySelectorAll('.book-container').forEach(container => {
        const bookId = container.dataset.bookId;
        const titleDiv = container.querySelector('.book-title');
        const authorDiv = container.querySelector('.book-author');
        titleDiv.textContent = getBookTitle(bookId, lang);
        if (authorDiv) {
          const authorName = getAuthorName(bookId, lang);
          const ui = UI_TEXT[lang] || UI_TEXT.en_us;
          authorDiv.textContent = authorName ? ui.byAuthor + authorName : '';
        }

        const contentDiv = container.querySelector('.book-content');
        contentDiv.innerHTML = '';

        const book = allBooksData[bookId];
        if (!book) return;

        let dataToShow = book[lang] || book.en_us;
        let note = !book[lang] && book.en_us ? UI_TEXT[lang]?.noTranslation(LANG_NAMES[lang]) : '';

        if (!dataToShow) {
          contentDiv.innerHTML = '<div class="error">No content.</div>';
          return;
        }

        if (note) {
          const noteEl = document.createElement('div');
          noteEl.className = 'no-translation';
          noteEl.textContent = note;
          contentDiv.appendChild(noteEl);
        }

        if (Array.isArray(dataToShow.contents)) {
          const pages = dataToShow.contents;
          pages.forEach((text, index) => {
            const pageDiv = document.createElement('div');
            pageDiv.className = 'page';
            pageDiv.appendChild(parseMinecraftText(text));
            contentDiv.appendChild(pageDiv);

            if (index < pages.length - 1) {
              const divider = document.createElement('div');
              divider.className = 'page-divider';
              contentDiv.appendChild(divider);
            }
          });
        }

        if (dataToShow.credit) {
          const credit = document.createElement('div');
          credit.className = 'credit';
          credit.textContent = `‚Äî ${dataToShow.credit}`;
          contentDiv.appendChild(credit);
        }
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await loadLanguageFiles();
      await loadBookAuthors();
      await loadBooks();
      document.getElementById('lang-select').addEventListener('change', () => {
        updateBookContents();
      });
    });
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BookSeries",
      "name": "Vampirism Mod Lore Books",
      "description": "The complete collection of lore and stories from the Vampirism Minecraft mod.",
      "genre": "Fantasy/Gaming",
      "url": "https://thegridexpert.github.io/vampirism-books"
    }
  </script>
</body>
</html>